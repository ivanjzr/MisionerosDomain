<?php

//
include PATH_BASE.DS.'js_versioning.phtml';
//
$user_info = $App::GetUserData();
$secion_name = $user_info['current']['nombre'];
//echo $secion_name; exit;

// 
$App::$header_scrits = <<<EOF
    <link rel="stylesheet" href="/adm/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <link rel="stylesheet" href="/adm/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/adm/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="/adm/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
EOF;

//
$App::$footer_scripts = <<<EOF
    <script src="/adm/plugins/jquery-form/jquery.form.min.js"></script>
    <script src="/adm/plugins/jquery-validation/jquery.validate.js"></script>
    
    <script src="/adm/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="/adm/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="/adm/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="/adm/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/adm/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="/adm/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/adm/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="/adm/plugins/jszip/jszip.min.js"></script>
    <script src="/adm/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="/adm/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="/adm/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="/adm/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="/adm/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
EOF;

///
$App::$footer_section_scripts = <<<EOF
    <script>
        var record_id = $record_id;
    </script>
    <script src="/adm/js/sections-handler.js?v=$js_files_version"></script>
    <script src="/app/customers/edit.js?v=$js_files_version"></script>
EOF;

//
$App::setSectionInfo("{$secion_name} {$record_id}", "customers");

?>

<?php include PATH_VIEWS_ADMIN.DS.'common'.DS.'header.phtml'; ?>
<?php include PATH_VIEWS_ADMIN.DS.'common'.DS.'aside-menu.phtml'; ?>

<!-- Main Content -->
<div class="container-fluid">
    
    <!-- Page Header -->
    <div class="row my-4">
        <div class="col-md-6">
            <h2>
                <i class="fas fa-user-edit me-2 text-primary"></i>
                Editar 
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="#" class="text-decoration-none">Home</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="/admin/customers/index" class="text-decoration-none"><?=$secion_name;?></a>
                    </li>
                    <li class="breadcrumb-item active">Editar</li>
                </ol>
            </nav>
        </div>
        <div class="col-md-6 text-end">
            <a href="/admin/customers/index" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>
                Back
            </a>
        </div>
    </div>

    <!-- Main Card with Tabs -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                
                <!-- Tabs Navigation -->
                <div class="card-header bg-light p-0">
                    <ul class="nav nav-tabs card-header-tabs" id="customerTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" 
                                    id="tab-detalles" 
                                    data-bs-toggle="tab" 
                                    data-bs-target="#detalles" 
                                    type="button" 
                                    role="tab" 
                                    aria-controls="detalles" 
                                    aria-selected="true">
                                <i class="fas fa-user me-2"></i>
                                Información
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" 
                                    id="tab-familiares" 
                                    data-bs-toggle="tab" 
                                    data-bs-target="#familiares" 
                                    type="button" 
                                    role="tab" 
                                    aria-controls="familiares" 
                                    aria-selected="false">
                                <i class="fas fa-users me-2"></i>
                                Familiares
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Tabs Content -->
                <div class="card-body">
                    <div class="tab-content" id="customerTabsContent">
                        
                        
                        <div class="tab-pane fade show active" 
                             id="detalles" 
                             role="tabpanel" 
                             aria-labelledby="tab-detalles">
                            
                            <!-- Loading Overlay -->
                            <div class="overlay-2 section-preloader">
                                <div class="d-flex justify-content-center align-items-center h-100">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary mb-2" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <div class="fw-medium">Cargando...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Header -->
                            <div class="row align-items-center mb-4">
                                <div class="col-md-8">
                                    <h4 class="mb-0">
                                        <i class="fas fa-edit me-2 text-primary"></i>
                                        Detalles <?=$secion_name;?> - <span class="section-title text-muted"></span>
                                    </h4>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button type="submit" form="form_section" class="btn btn-success me-2">
                                        <i class="fas fa-save me-1"></i>
                                        Save
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="btnReloadDetails">
                                        <i class="fas fa-sync"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Customer Form -->
                            <form method="post" id="form_section" name="form_section" enctype="multipart/form-data">
                                
                                <!-- Personal Information -->
                                <div class="section-header mb-3">
                                    <h6 class="section-title">
                                        <i class="fas fa-id-card text-info"></i>
                                        Información Personal
                                    </h6>
                                </div>
                                
                                <div class="row g-3 mb-4">
                                    <div class="col-md-6 col-12">
                                        <label for="name" class="form-label fw-medium">
                                            <i class="fas fa-user me-2 text-muted"></i>
                                            Nombre:
                                        </label>
                                        <input data-rule-required="true" 
                                               type="text" 
                                               class="form-control" 
                                               name="name" 
                                               id="name" 
                                               placeholder="Nombre...">
                                    </div>
                                    <div class="col-md-3 col-12">
                                        <label for="email" class="form-label fw-medium">
                                            <i class="fas fa-envelope me-2 text-muted"></i>
                                            Email:
                                        </label>
                                        <input data-rule-email="true" 
                                               type="email" 
                                               class="form-control" 
                                               name="email" 
                                               id="email" 
                                               placeholder="correo@ejemplo.com">
                                    </div>
                                    <div class="col-md-3 col-12">
                                        <label class="form-label fw-medium">Fecha de nacimiento</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="birth_date" readonly data-toggle="datetimepicker" data-target="#birth_date">
                                            <div class="input-group-append" data-toggle="datetimepicker" data-target="#birth_date">
                                                <span class="input-group-text">
                                                    <i class="fas fa-calendar"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Information -->
                                <div class="section-header mb-3">
                                    <h6 class="section-title">
                                        <i class="fas fa-phone text-success"></i>
                                        Información de Contacto
                                    </h6>
                                </div>
                                
                                <div class="row g-3 mb-4">
                                    <div class="col-sm-4 col-12">
                                        <label for="phone_country_id" class="form-label fw-medium">
                                            <i class="fas fa-flag me-2 text-muted"></i>
                                            Código País:
                                        </label>
                                        <select data-rule-required="true" 
                                                data-rule-number="true" 
                                                class="form-select" 
                                                id="phone_country_id" 
                                                name="phone_country_id" 
                                                disabled>
                                        </select>
                                    </div>
                                    
                                    <div class="col-sm-8 col-12">
                                        <label for="phone_number" class="form-label fw-medium">
                                            <i class="fas fa-phone me-2 text-muted"></i>
                                            Teléfono:
                                        </label>
                                        <input type="number" 
                                               data-rule-required="true" 
                                               data-rule-number="true" 
                                               class="form-control" 
                                               name="phone_number" 
                                               id="phone_number"
                                               placeholder="123456789">
                                    </div>
                                </div>

                                <!-- Additional Settings -->
                                <div class="section-header mb-3">
                                    <h6 class="section-title">
                                        <i class="fas fa-cog text-warning"></i>
                                        Configuración Adicional
                                    </h6>
                                </div>
                                
                                <div class="row g-3">
                                    <div class="col-sm-4 col-12">
                                        <div class="card bg-light border-0 h-100">
                                            <div class="card-body d-flex align-items-center justify-content-center">
                                                <div class="form-check">
                                                    <input type="checkbox" 
                                                           class="form-check-input" 
                                                           id="active" 
                                                           name="active">
                                                    <label class="form-check-label fw-medium" for="active">
                                                        Habilitado
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-sm-8 col-12">
                                        <label for="notes" class="form-label fw-medium">
                                            <i class="fas fa-sticky-note me-2 text-muted"></i>
                                            Notas:
                                        </label>
                                        <textarea class="form-control" 
                                                  name="notes" 
                                                  id="notes" 
                                                  rows="4"
                                                  placeholder="Notas adicionales sobre el cliente..."></textarea>
                                    </div>
                                </div>

                            </form>
                        </div>

                        <!-- Tab 2: Familiares -->
                        <div class="tab-pane fade" 
                             id="familiares" 
                             role="tabpanel" 
                             aria-labelledby="tab-familiares">
                            
                            <!-- Loading Overlay -->
                            <div class="overlay-2 section-preloader">
                                <div class="d-flex justify-content-center align-items-center h-100">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary mb-2" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <div class="fw-medium">Cargando...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Familiares Header -->
                            <div class="row align-items-center mb-4">
                                <div class="col-md-8">
                                    <h4 class="mb-0">
                                        <i class="fas fa-users me-2 text-success"></i>
                                        Familiares - <span class="section-title text-muted"></span>
                                    </h4>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button type="button" class="btn btn-success me-2" id="btnAddRelative">
                                        <i class="fas fa-plus me-1"></i>
                                        Add
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="btnReloadFamiliares">
                                        <i class="fas fa-sync"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Familiares Table -->
                            <div class="card border-0 bg-light">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table id="grid_customer_relatives" class="table table-hover mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th></th>
                                                    <th>Folio</th>
                                                    <th>
                                                        <i class="fas fa-user me-1 text-muted"></i>
                                                        Nombre Familiar
                                                    </th>
                                                    <th>Nacimiento/Edad</th>
                                                    <th>
                                                        <i class="fas fa-users me-1 text-muted"></i>
                                                        Tipo
                                                    </th>
                                                    <th>creacion</th>
                                                    <th width="100"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- DataTable content -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Record Info Footer -->
                    <div class="row mt-4 pt-3 border-top">
                        <div class="col-12 text-end">
                            <small class="text-muted">
                                <strong>Folio:</strong> <span id="registro_folio" class="text-dark">--</span> | 
                                <strong>Fecha Creación:</strong> <span id="registro_fecha_creacion" class="text-dark">--</span>
                            </small>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Input -->
    <input type="hidden" value="<?=$user_info['sucursal'];?>" id="sucursal_name">
    <input type="hidden" id="section_name" value="<?=$secion_name;?>" />

</div>

<?php include PATH_VIEWS_ADMIN.DS.'common'.DS.'footer.phtml'; ?>